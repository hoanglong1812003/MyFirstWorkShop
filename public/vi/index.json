[
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/3-simulateattacks/3.1-compromisedec2instance/",
	"title": "Compromised EC2 Instance",
	"tags": [],
	"description": "",
	"content": "Tình huống 1 Vào một buổi sáng thứ 2, bạn Long đến văn phòng sớm, chuẩn bị một tách cà phê, ngồi vào chỗ và mở laptop, bắt đầu các công việc hằng ngày như gửi E-mail, viết kế hoạch. Đột nhiên, bạn Long bắt đầu nhận một chuỗi những E-mails với nội dung liên quan đến sự phát hiện mới nhất đối với các mối nguy hại, điều mà bạn Long chưa từng thấy trước đây, tuy nhiên bạn Long bắt đầu tìm hiểu và điều tra ngay lập tức. Điều đáng mừng là đồng nghiệp của bạn, Việt đã thiết lập những phản ứng tự động dành cho những Findings ấy thế nên chúng đã được giải quyết tức.\nVậy những phản ứng tự động Việt đã thiết lập là những phản ứng nào?\nNội dung E-mail đầu tiên mà bạn Long được nhận được với việc EC2 instance của bạn có thể đã bị xâm nhập như sau:\nNội dung E-mail thứ hai ngay sau đó mà bạn nhận được với tình hình đã được giải quyết tức thì như sau:\nKiến trúc tổng quan Một EC2 compromised instance, tiến hành gửi gói tin pings đến địa chỉ EIP của một EC2 instance nguy hại. Địa chỉ EIP đó đã được thêm ở Custom Threat List. Security Hub phát hiện ra lỗ hổng bảo mật bất thường. GuardDuty tiến hành theo dõi VPC Flow Logs (kể cả CloudTrail và DNS Logs) và phân tích tình hình dựa trên Machine Learning, Custom Threat List và một số cở sở khác. GuardDuty sinh ra một Finding và hiển thị trên GuardDuty Console và gửi sự kiện này đến EventBridge Events. Dựa trên sự kiện này, EventBridge Event Rule tiến hành phản ứng và kích hoạt đồng thời SNS Topic và Lambda Function tương ứng. SNS Topic sẽ gửi E-mail cùng với chi tiết Finding cho bạn. Lambda Function sẽ tiến hành cô lập EC2 compromised instance. Khi Việt thiết lập thông báo E-mail cho sự kiện này, anh ấy chỉ thêm một vài thông tin nhất định về Finding ấy và cấu hình Lambda Function để tự động cô lập EC2 compromised instance. Mặc dù Finding đã được giải quyết, bạn vẫn quyết định tìm hiểu chi tiết hơn về các thiết lập và cấu hình hiện tại này của Việt.\nQuá trình điều tra Mặc dù bạn có thể thấy các Findings này từ GuardDuty Console, đa số các khách hàng đều muốn tập hợp chúng, từ các AWS Regions và AWS Accounts, đến một hệ thống quản lý dữ liệu bảo mật tập trung (SIEM) để tiến hành phân tích và thực hiện quá trình Remediations. Cách tiếp cận thông dụng nhất là cấu hình GuardDuty dưới một mô hình Admin/Member và sử dụng quy trình kết hợp giữa EventBridge Event Rules và Lambda Function để tiến hành đẩy những Findings này tới SIEM hoặc một Centralized Logging Framework. Ngoài ra còn có một số giải pháp đến từ các đối tác của AWS, giúp khách hàng thực hiện các tác vụ hợp nhất và đẩy dữ liệu dễ dàng nhất.\nTruy cập vào Security Hub ở ap-southeast-1.\nChúng ta sẽ thấy được các cảnh báo bảo mật ở GuardDuty với Finding: UnauthorizedAccess:EC2/MaliciousIPCaller.Custom.\nTiến hành truy cập vào GuardDuty Console ở ap-southeast-1\nChúng ta sẽ thấy được một Finding với định dạng như sau UnauthorizedAccess:EC2/MaliciousIPCaller.Custom.\nNếu không có Finding nào, vui lòng ấn refresh và đợi. Người dùng có thể truy xuất các Findings ở GuardDuty console trong vòng 90 ngày.\nTrong môi trường của bạn, kiểu Finding này chỉ ra rằng một EC2 instance đang thực hiện quá trình giao tiếp tới địa chỉ IP (đã được thêm vào Threat Lists). Tiến hành chọn Lists ở thanh điều hướng (bên tay trái) để có thể xem Threat List mà Việt đã thêm trước đây Example-Threat-List. GuardDuty sử dụng những hệ thống Threat Intelligence được cung cấp bởi đội ngũ AWS Security và bên thứ 3 như ProofPoint và CrowdStike. Bạn có thể mở rộng tầm quan sát của GuardDuty bằng cách tự cấu hình danh sách IP đáng tin cậy (Trusted IP Lists) và danh sách các mối nguy hại (Threat Lists). Nếu bạn đã thiết lập GuardDuty theo cấu trúc Admin/Member, từ tài khoản GuardDuty Admin, bạn có thể quản lý các danh sách trên và để các tài khoản Members kế thừa. Mặc nhiên, các tài khoản Members sẽ không quyền chỉnh sửa các danh sách này.\nTrong tình huống giả lập này, EC2 compromised instance chỉ tiến hành truy cập đến EIP của một EC2 instance khác trong cùng VPC nhằm nội bộ hoá quá trình giả lập cùng luồng xử lý dữ liệu chỉ xảy ra trong môi trường của bạn. CloudFormation Template sẽ tự động tạo danh sách mối nguy hại (Threat Lists) và gán địa chỉ EIP này vào đó.\nKiểm tra EventBridge Event Rule Việt sử dụng EventBridge Event Rules để gửi thông báo đến bạn về các Findings cùng với nội dung các bước của quá trình Remediations. Chúng ta sẽ tiến hành khảo sát chi tiết hơn để hiểu rõ Việt đã thiết lập những gì và quá trình này diễn ra như thế nào?\nTruy cập vào EventBridge Console ở ap-southeast-1. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event.\nTiến hành chọn quy tắc có tên là GuardDuty-Event-EC2-MaliciousIPCaller.\nBạn sẽ dễ dàng nhận thấy có 2 mục tiêu tại vùng Targets. Lambda Function SNS Topic: Tiến hành gửi thông báo E-mail cho bạn dựa trên dữ liệu được cung cấp bởi EventBridge Event Rule. Thay vì toàn bộ dữ liệu JSON được sử dụng, bằng việc sử dụng Input Transformer, Việt đã tuỳ chỉnh nội dung thông báo. Kiểm tra quá trình Remediation dựa trên Lambda Function\nLambda Function là chìa khoá nắm giữ logic nhằm thực hiện các bước của quá trình Remediations dành cho các Findings. Việt đã thiết lập Lambda Function nhằm loại bỏ và thay thế Security Group của EC2 compromised instance bằng một Security Group không chứa bất kỳ một quy tắc Ingress/Egress nào. Điều này sẽ giúp cô lập EC2 compromised instance ra khỏi hệ thống mạng hiện tại.\nĐể tiến hành kiểm tra quá trình Remediation:\nTừ quy tắc GuardDuty-Event-EC2-MaliciousIPCaller, tại vùng Targets, ở mục Type là Lambda Function, chúng ta tìm kiếm Resource Name tương ứng.\nTại Lambda Function console, tìm kiếm Resource Name theo bước trước.\nChúng ta có thể xem xét một số mục\nConfiguration. Tại thanh Designer, chúng ta sẽ dễ dàng thấy mối quan hệ với EventBridge Event Rule. Ở phần Function code, những logic về coding sẽ được thực thi tại đây. Permissions. Monitoring. Xác nhận quá trình Remediation đã thành công Để đảm bảo kết quả của quá trình Remediation, chúng ta cần phải xem xét EC2 instance đã bị cô lập hay chưa. Tại thời điểm này, bạn đã nhận được một E-mail cùng với một số thông tin quan trọng.\nTruy cập vào EC2 console ở ap-southeast-1 tại đây. Chọn Instances, chúng sẽ thấy được 3 EC2 instance với tiền tố bắt đầu với định dạng sau GuardDuty-Example.\nDựa trên instance ID có từ GuardDuty Finding hay thông báo E-mail, chúng ta chọn EC2 instance tương ứng: GuardDuty-Example: Compromised Instance: Scenario 1.\nSau khi quá trình Remediation hoàn thành, chúng ta sẽ kiểm tra Security Group của EC2 compromised instance này, sẽ có định dạng tên tương tự sau ForensicSecurityGroup. ForensicSecurityGroup sẽ không có bất kỳ một quy tắc Ingress/Egress nào chứa địa chỉ IP trong Example-Threat-List. "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/1-introduce/",
	"title": "Giới thiệu",
	"tags": [],
	"description": "",
	"content": "Tổng quan Trong bài lab này, các bạn sẽ được tìm hiểu về Amazon GuardDuty kết hợp với AWS Security Hub. Amazon GuardDuty là một dịch vụ có chức năng phát hiện các mối đe dọa đến hệ thống và khắc phục chúng, trong khi AWS Security Hub sẽ cung cấp cho chúng ta cái nhìn toàn diện về các cảnh báo bảo mật ưu tiên và trạng thái tuân thủ trên các tài khoản AWS. Chúng ta sẽ cùng nhau phân tích, đánh giá và làm thế nào để báo động cũng như khắc phục các vấn đề bảo mật dựa trên các \u0026ldquo;Findings\u0026rdquo; của GuardDuty và Security Hub.\nVề GuardDuty Nguồn dữ liệu Kể từ khi được kích hoạt trên một AWS Region, GuardDuty sẽ tiến hành phân tích mọi dữ liệu đến từ:\nVPC Flow Logs\nCloudTrail Logs\nDNS Logs\nNhật ký lưu trữ của DNS xuất phát từ các DNS resolvers (sở hữu bởi AWS) dành cho các VPC và không thể truy xuất trực tiếp từ phía người dùng. Nếu như DNS resolver được cấu hình độc lập bởi chính bạn hoặc từ phía bên thứ 3, GuardDuty sẽ không thể truy xuất, xử lý và xác định các mối nguy hại từ nguồn dữ liệu này. GuardDuty có thể truy xuất đến mọi nguồn dữ liệu (được đề cập ở trên) cho dù chúng chưa được kích hoạt từ trước.\nBạn nên kích hoạt đồng thời CloudTrail Logs và VPC Flow Logs để có cái nhìn tổng quan và chi tiết nhất khi tiến hành phân tích dữ liệu.\nGuardDuty là một dịch vụ mang tính chất Regional, thế nên để có thể theo dõi dữ liệu ở một AWS Region thì bạn phải kích hoạt ở AWS Region đó.\nBạn có thể kích hoạt thông qua AWS Console hoặc sử dụng APIs. Đa số người dùng sẽ kích hoạt ở mọi AWS Regions và AWS Accounts một cách đồng thời thông qua APIs.\nDù bạn có số lượng các tài nguyên AWS ít hay nhiều (ví dụ như VPCs hay IAM users), GuardDuty sẽ không gây bất kỳ ảnh hưởng nào đến bất kỳ tài nguyên nào bởi các quy trình xử lý sẽ chỉ được thực hiện nội bộ bên trong dịch vụ GuardDuty.\nGuardDuty là một dịch vụ được quản lý hoàn toàn bởi AWS.\nCách tính giá của GuardDuty sẽ dựa trên\nSố lượng CloudTrail events được phân tích. Khối lượng của VPC floư logs (theo GB). Khối lượng của DNS log (theo GB). Mỗi tài khoản AWS sẽ có 30 ngày thử nghiệm ở mỗi AWS Region, điều này sẽ giúp GuardDuty dễ dàng dự đoán chi phí phát sinh.\nFindings GuardDuty sẽ chủ động quan sát và theo dõi các dấu hiệu bất thường xuất phát từ:\n3 nguồn dữ liệu (được đề cập ở trên). Các EC2 Instances. Các tài nguyên AWS IAM. Bạn sẽ dễ dàng truy xuất chi tiết các Findings được phát hiện bởi GuardDuty ở thanh Findings. Mỗi Finding sẽ được chia nhỏ thành nhiều thông tin theo định dạng mà cho phép chúng ta dễ dàng đọc hiểu và xử lý các nguy cơ về bảo mật. Tìm hiểu chi tiết hơn về danh sách của toàn bộ các loạt GuardDuty Findings tại đây.\nVề AWS Security Hub AWS Security Hub cung cấp cho bạn cái nhìn toàn diện về các cảnh báo bảo mật ưu tiên cao và trạng thái tuân thủ trên các tài khoản AWS.\nSẽ có rất nhiều các công cụ bảo mật mạnh mẽ để bạn sử dụng, từ tường lửa hay ứng dụng bảo vệ endpoint đến các ứng dụng quét lỗ hổng và sự tuân thủ bảo mật. Nhưng đôi khi, điều này khiến đội ngũ của bạn phải chuyển đổi qua lại giữa các công cụ này để đối phó với hàng trăm, hàng nghìn cảnh báo bảo mật mỗi ngày. Với Security Hub, giờ đây bạn có một nơi tổng hợp duy nhất, sắp xếp và phân độ ưu tiên các cảnh báo hoặc phát hiện bảo mật từ nhiều dịch vụ AWS (như Amazon GuardDuty, Amazon Inspector và Amazon Macie) hay từ các giải pháp cung cấp bởi đối tác của AWS.\nCác rủi ro được tìm thấy sẽ được tóm tắt trực quan trên trang tổng quan tích hợp với các biểu đồ và bảng mà bạn có thể tương tác. Bạn cũng có thể giám sát hệ thống của bạn liên tục bằng cách sử dụng chức năng kiểm tra tự động sự tuân thủ so với các thực nghiệm tối ưu từ AWS và các tiêu chuẩn trên thị trường mà doanh nghiệp của bạn đang tuân theo.\nChi phí Thông thường, chi phí sẽ ít hơn $1 mỗi tháng nếu tài khoản của bạn chỉ sử dụng cho mục đích thử nghiệm, luyện tập và không thực hiện những cuộc tấn công giả lập. Kiểm tra bảo mật\n100,000 lần đầu tiên =\u0026gt; $0.0010/check. 100,001 – 500,000 =\u0026gt; $0.0008/check. 500,001+ =\u0026gt; $0.0005/check. Tìm các sự kiện tấn công 10,000 lần đầu tiên =\u0026gt; miễn phí. 10,001+ =\u0026gt; $0.00003/lần. So sánh Amazon GuardDuty và AWS Security Hub Tiêu chí Amazon GuardDuty AWS Security Hub Mục đích chính Phát hiện mối đe dọa tự động dựa trên hành vi và machine learning Tổng hợp, chuẩn hóa và đánh giá các cảnh báo bảo mật từ nhiều nguồn Dữ liệu xử lý VPC Flow Logs, CloudTrail Events, DNS logs Cảnh báo từ GuardDuty, Inspector, IAM Access Analyzer,\u0026hellip; Cách hoạt động Phân tích log, sử dụng AI và threat intel để phát hiện bất thường Thu thập và chuẩn hóa cảnh báo theo chuẩn ASFF Phản ứng sự kiện Gửi cảnh báo đến CloudWatch, kích hoạt Lambda Cho phép tạo Custom Actions, tích hợp với Lambda, EventBridge Chuẩn cảnh báo Định dạng nội bộ riêng AWS Security Finding Format (ASFF) Ưu điểm Không cần cài agent, phát hiện real-time, tự động Tổng hợp toàn diện, tích hợp nhiều nguồn, hỗ trợ Best Practice Nhược điểm Không có báo cáo tổng hợp, có thể tạo cảnh báo giả Phụ thuộc vào nguồn cảnh báo khác, có thể quá tải thông tin Có thể kết hợp cả hai: sử dụng GuardDuty để phát hiện mối đe dọa, sau đó gửi findings về Security Hub để tổng hợp, đánh giá và phản ứng.\nNội dung Giới thiệu Các bước chuẩn bị Mô phỏng các cuộc tấn công Dọn dẹp tài nguyên "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/2-prerequiste/2.1-enableguardduty/",
	"title": "Kích hoạt GuardDuty",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ cần kích hoạt GuardDuty trước khi tạo Stack.\nTriển khai Kích hoạt GuardDuty\nĐăng nhập vào AWS Console, truy cập vào dịch vụ GuardDuty. Bắt đầu bằng cách chọn Get started. Đối với tài khoản mới, AWS sẽ cho chúng ta 30 ngày dùng thử, để bắt đầu sử dụng, nhấn chọn nút Enable GuardDuty. Sau khi kích hoạt GuardDuty xong, chúng ta sẽ tiến hành kích hoạt thêm Security Hub.\n"
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/",
	"title": "Phát hiện các mối đe dọa với Amazon Security Hub &amp; Amazon GuardDuty",
	"tags": [],
	"description": "",
	"content": "Phát hiện các mối đe dọa với Amazon Security Hub \u0026amp; Amazon GuardDuty Tổng quan Trong bài workshop này, các bạn sẽ được tìm hiểu về Amazon GuardDuty kết hợp với AWS Security Hub. Amazon GuardDuty là một dịch vụ có chức năng phát hiện các mối đe dọa đến hệ thống và khắc phục chúng, trong khi AWS Security Hub sẽ cung cấp cho chúng ta cái nhìn toàn diện về các cảnh báo bảo mật ưu tiên và trạng thái tuân thủ trên các tài khoản AWS. Chúng ta sẽ cùng nhau phân tích, đánh giá và làm thế nào để báo động cũng như khắc phục các vấn đề bảo mật dựa trên các \u0026ldquo;Findings\u0026rdquo; của GuardDuty và Security Hub.\nVề GuardDuty Nguồn dữ liệu Kể từ khi được kích hoạt trên một AWS Region, GuardDuty sẽ tiến hành phân tích mọi dữ liệu đến từ:\nVPC Flow Logs\nCloudTrail Logs\nDNS Logs\nNhật ký lưu trữ của DNS xuất phát từ các DNS resolvers (sở hữu bởi AWS) dành cho các VPC và không thể truy xuất trực tiếp từ phía người dùng. Nếu như DNS resolver được cấu hình độc lập bởi chính bạn hoặc từ phía bên thứ 3, GuardDuty sẽ không thể truy xuất, xử lý và xác định các mối nguy hại từ nguồn dữ liệu này. GuardDuty có thể truy xuất đến mọi nguồn dữ liệu (được đề cập ở trên) cho dù chúng chưa được kích hoạt từ trước.\nBạn nên kích hoạt đồng thời CloudTrail Logs và VPC Flow Logs để có cái nhìn tổng quan và chi tiết nhất khi tiến hành phân tích dữ liệu\nGuardDuty là một dịch vụ mang tính chất Regional, thế nên để có thể theo dõi dữ liệu ở một AWS Region thì bạn phải kích hoạt ở AWS Region đó.\nBạn có thể kích hoạt thông qua AWS Console hoặc sử dụng APIs. Đa số người dùng sẽ kích hoạt ở mọi AWS Regions và AWS Accounts một cách đồng thời thông qua APIs.\nDù bạn có số lượng các tài nguyên AWS ít hay nhiều (ví dụ như VPCs hay IAM users), GuardDuty sẽ không gây bất kỳ ảnh hưởng nào đến bất kỳ tài nguyên nào bởi các quy trình xử lý sẽ chỉ được thực hiện nội bộ bên trong dịch vụ GuardDuty.\nGuardDuty là một dịch vụ được quản lý hoàn toàn bởi AWS.\nCách tính giá của GuardDuty sẽ dựa trên\nSố lượng CloudTrail events được phân tích Khối lượng của VPC floư logs (theo GB) Khối lượng của DNS log (theo GB) Mỗi tài khoản AWS sẽ có 30 ngày thử nghiệm ở mỗi AWS Region, điều này sẽ giúp GuardDuty dễ dàng dự đoán chi phí phát sinh.\nFindings GuardDuty sẽ chủ động quan sát và theo dõi các dấu hiệu bất thường xuất phát từ:\n3 nguồn dữ liệu (được đề cập ở trên) Các EC2 Instances Các tài nguyên AWS IAM Bạn sẽ dễ dàng truy xuất chi tiết các Findings được phát hiện bởi GuardDuty ở thanh Findings. Mỗi Finding sẽ được chia nhỏ thành nhiều thông tin theo định dạng mà cho phép chúng ta dễ dàng đọc hiểu và xử lý các nguy cơ về bảo mật. Tìm hiểu chi tiết hơn về danh sách của toàn bộ các loạt GuardDuty Findings tại đây\nVề AWS Security Hub AWS Security Hub cung cấp cho bạn cái nhìn toàn diện về các cảnh báo bảo mật ưu tiên cao và trạng thái tuân thủ trên các tài khoản AWS\nSẽ có rất nhiều các công cụ bảo mật mạnh mẽ để bạn sử dụng, từ tường lửa hay ứng dụng bảo vệ endpoint đến các ứng dụng quét lỗ hổng và sự tuân thủ bảo mật. Nhưng đôi khi, điều này khiến đội ngũ của bạn phải chuyển đổi qua lại giữa các công cụ này để đối phó với hàng trăm, hàng nghìn cảnh báo bảo mật mỗi ngày. Với Security Hub, giờ đây bạn có một nơi tổng hợp duy nhất, sắp xếp và phân độ ưu tiên các cảnh báo hoặc phát hiện bảo mật từ nhiều dịch vụ AWS (như Amazon GuardDuty, Amazon Inspector và Amazon Macie) hay từ các giải pháp cung cấp bởi đối tác của AWS.\nCác rủi ro được tìm thấy sẽ được tóm tắt trực quan trên trang tổng quan tích hợp với các biểu đồ và bảng mà bạn có thể tương tác. Bạn cũng có thể giám sát hệ thống của bạn liên tục bằng cách sử dụng chức năng kiểm tra tự động sự tuân thủ so với các thực nghiệm tối ưu từ AWS và các tiêu chuẩn trên thị trường mà doanh nghiệp của bạn đang tuân theo.\nChi phí Thông thường, chi phí sẽ ít hơn $1 mỗi tháng nếu tài khoản của bạn chỉ sử dụng cho mục đích thử nghiệm, luyện tập và không thực hiện những cuộc tấn công giả lập. Kiểm tra bảo mật\n100,000 lần đầu tiên =\u0026gt; $0.0010/check 100,001 – 500,000 =\u0026gt; $0.0008/check 500,001+ =\u0026gt; $0.0005/check Tìm các sự kiện tấn công 10,000 lần đầu tiên =\u0026gt; miễn phí 10,001+ =\u0026gt; $0.00003/lần So sánh Amazon GuardDuty và AWS Security Hub Tiêu chí Amazon GuardDuty AWS Security Hub Mục đích chính Phát hiện mối đe dọa tự động dựa trên hành vi và machine learning Tổng hợp, chuẩn hóa và đánh giá các cảnh báo bảo mật từ nhiều nguồn Dữ liệu xử lý VPC Flow Logs, CloudTrail Events, DNS logs Cảnh báo từ GuardDuty, Inspector, IAM Access Analyzer,\u0026hellip; Cách hoạt động Phân tích log, sử dụng AI và threat intel để phát hiện bất thường Thu thập và chuẩn hóa cảnh báo theo chuẩn ASFF Phản ứng sự kiện Gửi cảnh báo đến CloudWatch, kích hoạt Lambda Cho phép tạo Custom Actions, tích hợp với Lambda, EventBridge Chuẩn cảnh báo Định dạng nội bộ riêng AWS Security Finding Format (ASFF) Ưu điểm Không cần cài agent, phát hiện real-time, tự động Tổng hợp toàn diện, tích hợp nhiều nguồn, hỗ trợ Best Practice Nhược điểm Không có báo cáo tổng hợp, có thể tạo cảnh báo giả Phụ thuộc vào nguồn cảnh báo khác, có thể quá tải thông tin Có thể kết hợp cả hai: sử dụng GuardDuty để phát hiện mối đe dọa, sau đó gửi findings về Security Hub để tổng hợp, đánh giá và phản ứng.\nNội dung Giới thiệu GuardDuty \u0026amp; Security Hub Compromised EC2 Instance Compromised IAM credentials Credential Exfiltration Dọn dẹp tài nguyên "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/2-prerequiste/",
	"title": "Các bước chuẩn bị",
	"tags": [],
	"description": "",
	"content": "Tổng quan Trong các bước tiếp theo, chúng ta sẽ tiến hành kích hoạt GuardDuty, Security Hub và tạo Stack.\nTình huống Bài thực hành sẽ mô tả các tình huống sau\nThứ tự Tên Đặc tả Giải pháp 1 Compromised EC2 instance Phát hiện và hồi phục EC2 instance bị tấn công Sự kết hợp giữa Amazon GuardDuty, Amazon EventBridge Event Rules và AWS Lambda 2 Compromised IAM credentials Xác định một cá nhân đang chủ động gọi API đến hệ thống trên AWS Khắc phục mối nguy hại này ngay lập tức một cách thủ công (manually) 3 IAM role exfiltration Thông qua một credential bị rò rỉ, một cá nhân đang cố gắng xâm nhập và gọi API từ một máy chủ bên ngoài Tiến hành khắc phục với AWS Lambda Nội dung Kích hoạt GuardDuty Kích hoạt Security Hub Tạo Stack "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/3-simulateattacks/3.2-compromisediamcredentials/",
	"title": "Compromised IAM credentials",
	"tags": [],
	"description": "",
	"content": "Tình huống 2: Compromised IAM credentials Bạn Long đã hoàn thành tình huống giả lập tấn công đầu tiên và quay trở lại với tách cà phê của mình. Tuy nhiên, bạn Long lại tiếp tục nhận thêm những thông báo mới về những Findings liên quan tới các dịch vụ AWS IAM. Nội dung thông báo đầu tiên chỉ ra rằng, bằng cách sử dụng IAM credentials, một số API calls đã được thực hiện từ địa chỉ IP đã được thêm vào Threat List (ở bài trước).\nKhông có bất kỳ IAM credentials cá nhân nào đã từng bị phơi bày hay lộ ra dưới bất kỳ hình thức nào.\nKiến trúc tổng quan EC2-malicious instance này tiến hành thực hiện các API calls, EIP của instance này đã được thêm vào Threat List. Nội dung các API calls đã được lưu lại trong nhật ký của CloudTrail. Security Hub phát hiện các hành động đáng ngờ được phát hiện bởi GuardDuty GuardDuty quan sát nhật ký của CloudTrail Logs cùng với VPC Flow Logs và DNS Logs, qua đó đánh giá tình hình dựa trên một số cơ sở nhất định. GuardDuty tạo ra những Findings tương ứng và đồng thời gửi chi tiết đến GuardDuty Console và EventBridge Events. EventBridge Event Rule tiến hành kích hoạt SNS Topic. SNS Topic tiến hành gửi thông báo E-mail cùng với thông tin liên quan. Quá trình điều tra Để tiến hành xem xét các Findings:\nTruy cập Security Hub, chúng ta phát hiện ra lỗ hổng bảo mật được phát hiện bởi GuardDuty Truy cập vào GuardDuty Console ở ap-southeast-1 tại đây. Chúng ta sẽ thấy được các Findings với định dạng như sau. Recon:IAMUser. UnauthorizedAccess:IAMUser. Nếu không có bất kỳ Finding nào, tiến hành nhấn nút Refresh và đợi. Từ Finding Recon:IAMUser/MaliciousIPCaller.Custom, chúng ta có thể dễ dàng truy xuất một số thông tin sau: Chuyện gì đã xảy ra? Tài nguyên AWS nào bị ảnh hưởng? Sự kiện này xảy ra khi nào? Ở dưới phần Resource Affected, bạn sẽ kiếm được User Name mà liên quan đến Finding này. Finding này chỉ ra rằng IAM credential của User Name trên đã có thể bị phơi bày bởi những API calls xuất phát từ địa chỉ IP mà trước đó đã được thêm vào Threat List.\nVậy những hành động nào đã được IAM User này thực hiện?\nỞ mục Action, chúng ta thấy được hành động DescribeParameters đã được thực hiện.\nLàm thế nào để chúng ta có thể thấy được hết các hành động còn lại, được thực hiện bởi IAM User này, trong vòng 1 tiếng trước hay 1 ngày truớc?\nGuardDuty có khả năng phân tích một lượng lớn dữ liệu nhằm xác định chính xác mối nguy hiểm có mặt trong môi trường của bạn. Tuy nhiên, trong quá trình điều tra và các bước thực hiện Remediation, chúng ta cũng cần kết hợp nhiều nguồn dữ liệu khác nhau để có một cái nhìn tương quan nhất có thể.\nTrong trường hợp này, nhà phân tích có thể sử dụng các thông tin chi tiết có thể tìm thấy trong nhật ký hành vi người dùng thông qua CloudTrail.\nNhững Findings về IAM được sinh ra bởi EC2 malicious instance đã thực hiện những API calls và EIP của instance này nằm trong Custom Threat List.\nKiểm tra EventBridge Event Rule\nTruy cập vào EventBridge Event Rule Console ở ap-southeast-1. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event.. Tiến hành chọn quy tắc có tên là GuardDuty-Event-IAMUser-MaliciousIPCaller Bạn sẽ dễ dàng nhận thấy chỉ có 1 mục tiêu tại vùng Targets là SNS Topic. Hoá ra, Việt chưa từng thiết lập Lambda Function để thực hiện quá trình Remediation bởi đội ngũ Security đã đưa ra quyết định rằng họ sẽ tiến hành một cách thủ công đối với Finding này.\nSự kết hợp giữa GuardDuty, Security Hub và EventBridge Events mang lại sự uyển chuyển giúp cho chúng ta dễ dàng tạo ra một quy trình Remediation tự động hoá. Lambda function hay giải pháp đến từ phía đối tác của AWS là những lựa chọn hàng đầu.\nĐối với một số Finding nhất định, chúng ta có thể sẽ chỉ cấu hình thông báo và giải quyết vấn đề một cách thủ công, thay vì tự động hoá. Bởi khi thiết kế quá trình tự động hoá, chúng ta sẽ phải vô cùng lưu ý và đánh giá kết quả mà quá trình Remediation mang lại, bao gồm cả ưu điểm và nhược điểm.\nNgoài ra, chúng ta có thể thiết lập Target đối một số tài nguyên AWS khác như SSM Run Commands hay Step Function State Machine.\nGiải quyết tình hình Bởi Việt chưa từng thiết lập quá trình Remediation đối với Finding này nên bạn Long cần phải thực hiện một cách thủ công. Trong khi đội ngũ Security đang tiến hành phân tích những hành vi của IAM user này để xác định rõ hơn phạm vi lỗ hổng, bạn Long cần phải thực hiện một số bước để vô hiệu hoá Access Key nhằm ngăn chặn lập tức những hành động tiếp theo.\nTruy cập vào IAM Console tại đây Ở thanh điều hướng bên tay trái, chọn Users. Dựa trên GuardDuty Finding và thông báo E-mail, chúng ta dễ dàng chọn ra được IAM user - GuardDuty-Example-Compromised-Simulated. Ở user GuardDuty-Example-Compromised-Simulated, chúng ta chọn thanh Security Credentials. Ở mục Access Keys, dựa trên thông tin Access Key ID từ Finding, chúng ta tiến hành chọn Action -\u0026gt; Deactivate. "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/3-simulateattacks/3.3-createfindings/",
	"title": "Create Findings",
	"tags": [],
	"description": "",
	"content": "Tình huống 3: Bạn Long vừa nhận ra các cuộc tấn công vừa rồi là các cuộc tấn công giả lập, các Findings được tự động tạo ra từ CloudFormation Template để xem xét khả năng bảo mật của Security Hub và GuardDuty. Tuy nhiên rủi ro bảo mật vẫn còn có, một hacker tên Bảo đã tiến hành truy xuất thành công IAM security credential tạm thời được sinh ra bởi IAM role thuộc EC2 instance. Vậy hacker này đã tiến hành truy xuất ra sao?\nTruy xuất IAM security credential tạm thời với Systems Manager\nĐể tiến hành cuộc tấn công cuối cùng này, Bảo cần phải truy xuất thành công IAM security credential tạm thời được sinh ra bởi IAM role thuộc EC2 instance. Bảo có thể thử 1 trong 2 cách sau:\nTruy cập SSH vào EC2 instance và tiến hành truy vấn dữ liệu Metadata của EC2 instance. Sử dụng chức năng Session Manager của dịch vụ AWS System Manager. Chúng ta sẽ tiến hành tạo các Findings\nTruy cập vào Session Manager ở ap-southeast-1. Ở thanh điều hướng bên tay phải, chọn tiếp tục Start Session. Ở mục Target instances chúng ta sẽ thấy một managed EC2 instance với định dạng tên như sau - GuardDuty-Example: Compromised Instance: Scenario 3 với trạng thái SSM Agent ping status là Online. Chọn instance GuardDuty-Example: Compromised Instance: Scenario 3 và ấn Start session. Thực hiện câu lệnh truy vấn dữ liệu Metadata:\ncurl http://169.254.169.254/latest/meta-data/iam/security-credentials/GuardDuty-Example-EC2-Compromised\rMở notepad, tiến hành ghi chú một số thông tin quan trọng sau:\nAccess Key ID. Secret Access Key. Session Token. Tạo AWS CLI Profile trên máy tính cá nhân Sau khi thành công truy xuất IAM security credential tạm thời, chúng ta sẽ tiến hành tạo một AWS CLI Profile trên máy tính cá nhân. Từ Terminal/CMD/PowerShell, chúng ta tiến hành thay thế các với giá trị cụ thể đã thu thập, sau đó thực hiện nhập các lệnh sau:\naws configure set profile.iamhacker.region ap-southeast-1\raws configure set profile.iamhacker.aws_access_key_id \u0026lt;ACCESS_KEY_ID\u0026gt;\raws configure set profile.iamhacker.aws_secret_access_key \u0026lt;SECRET_ACCESS_KEY\u0026gt;\raws configure set profile.iamhacker.aws_session_token \u0026lt;SESSION_TOKEN\u0026gt;\rChúng ta có thể sử dụng câu lệnh sau để tiến hành kiểm tra nhanh xem đã có AWS CLI Profile tên là iamhacker hay chưa.\naws configure --profile iamhacker\rThực hiện câu lệnh AWS CLI bằng IAM security credential tạm thời Bằng các câu lệnh AWS CLI dưới đây, chúng ta tiến hành thực hiện gọi API đến những dịch vụ AWS khác nhau.\nIAM user có bất kỳ quyền hạn nào?\naws iam get-user --profile iamhacker\raws iam create-user --user-name BuiChiBao --profile iamhacker\rNhư vậy IAM user không thể get-user cũng như create-user\nLiệu có quyền truy cập đến DynamoDB?\naws dynamodb list-tables --profile iamhacker\raws dynamodb describe-table --table-name GuardDuty-Example-Customer-DB --profile iamhacker\rLiệu có quyền truy vấn dữ liệu đến DynamoDB?\naws dynamodb scan --table-name GuardDuty-Example-Customer-DB --profile iamhacker\raws dynamodb delete-table --table-name GuardDuty-Example-Customer-DB --profile iamhacker\raws dynamodb list-tables --profile iamhacker\rNhư vậy hacker có quyền truy cập và truy vấn dữ liệu đến DynamoDB\nLiệu có thể truy cập đến System Manager Parameter Store?\naws ssm describe-parameters --profile iamhacker\raws ssm get-parameters --names \u0026quot;gd_prod_dbpwd_sample\u0026quot; --profile iamhacker\raws ssm get-parameters --names \u0026quot;gd_prod_dbpwd_sample\u0026quot; --with-decryption --profile iamhacker\raws ssm delete-parameter --name \u0026quot;gd_prod_dbpwd_sample\u0026quot; --profile iamhacker\rNhư vậy hacker có quyền truy cập đến System Manager Parameter Store\n"
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/3-simulateattacks/3.4-credential-exfiltration/",
	"title": "Credential Exfiltration",
	"tags": [],
	"description": "",
	"content": "Kiến trúc tổng quan Truy xuất IAM security credential tạm thời với Systems Manager\nMáy chủ từ xa truy cập đến EC2 compromised instance và đánh cắp IAM role credential thông qua dữ liệu Metadata. Máy chủ này thiết lập AWS CLI Profile để tiến hành gọi API đến tài khoản AWS. Security Hub phát hiện các bất thường GuardDuty sinh ra những Findings liên quan và đồng thời gửi tới GuardDuty console và EventBridge Events. EventBridge Event Rule kích hoạt SNS Topic và Lambda Function. SNS Topic tiến hành gửi thông báo E-mail với chi tiết Finding. Lambda Function tiến hành gán một chính sách mới nhằm thu hồi mọi Sessions đang hoạt động. Quá trình điều tra Truy cập Security Hub, chúng ta thấy Findings ở mức High được phát hiện bởi GuardDuty. Truy cập GuardDuty Console.\nChúng ta sẽ thấy được Findings với định dạng như sau UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.\nNếu không có bất kỳ Finding nào, tiến hành nhấn nút Refresh và đợi. Từ Finding UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration, chúng ta có thể dễ dàng truy xuất một số thông tin sau: High Severity Thông báo rằng có người cố ý sử dụng IAM role credential ở ngoài EC2 instance Mỗi GuardDuty Finding sẽ được gán một mức độ nghiêm trọng cụ thể - Low/Medium/High. Các mức độ này được định nghĩa bởi AWS, chúng được dùng để phân loại và xác định\nKiểm tra EventBridge Event Rule\nTruy cập vào EventBridge Event Rule ở ap-southeast-1. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event... Tiến hành chọn quy tắc có tên là GuardDuty-Event-IAMUser-InstanceCredentialExfiltration. Ở mục Event Pattern, chúng ta dễ dàng thấy được nguồn dữ liệu mà Event này sẽ ghi nhận và tiến hành kích hoạt các Target khi có bất kỳ sự kiện nào. Bạn có thể tạo EventBridge Event Rule nhằm ghi nhận sự kiện của một loại Finding cụ thể hay bất kỳ loại Finding nào.\nKiểm tra quá trình Remediation với Lambda Function\nViệt đã thiết lập quá trình Remediation nhằm phản ứng tự động với mối nguy hại này thông qua Lambda function. Chúng ta có thể kiểm tra đoạn mã được lập trình để hiểu thêm về quá trình này.\nTruy cập vào Lambda Console ở ap-southeast-1. Ở thanh điều hướng bên tay trái, chọn Functions và tìm kiếm GuardDuty-Example-Remediation-InstanceCredentialExfiltration. Về cơ bản, Lambda function này sẽ truy xuất thông tin về IAM Role từ Finding và tiến hành thêm IAM Policy.\nKiểm chứng quá trình Remediation\nĐể tiến hành kiểm chứng liệu Finding InstanceCredentialExfiltration đã được giải quyết triệt để, chúng ta sẽ lần lượt tiến hành các bước sau.\nKiểm chứng thông qua AWS CLI Tiến hành thực thi câu lệnh sau:\naws dynamodb list-tables --profile iamhacker\rChúng ta sẽ nhận được kết quả trả về sẽ là AccessDeniedException cho câu lệnh thực thi.\n"
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/2-prerequiste/2.2-enablesecurityhub/",
	"title": "Kích hoạt Security Hub",
	"tags": [],
	"description": "",
	"content": "Kích hoạt Security Hub Trong bước này chúng ta sẽ tiến hành kích hoạt Security Hub để người dùng có cái nhìn tổng quan hơn về các cảnh báo bảo mật.\nĐăng nhập vào AWS Console Truy cập vào Giao diện quản trị dịch vụ AWS Security Hub. Chọn Security Hub CSPM, sau đó click Get started. Tại trang Enable AWS Security Hub CSPM, chọn các tiêu chuẩn về bảo mật (Security standards) như là AWS Foundational Security Best Practices, CIS AWS Foundations Benchmark, và PCI DSS. Chọn Enable Security Hub. Sau khi kích hoạt, bạn sẽ cần chờ một khoản thời gian để Security Hub đánh giá Security Score của tài khoản hiện tại của bạn so với từng bộ tiêu chuẩn bảo mật mà bạn thiết lập. "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/3-simulateattacks/",
	"title": "Mô phỏng các cuộc tấn công",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ quan sát và thực hiện các giao thức bảo mật cần thiết với 3 tình huống mô phỏng các cuộc tấn công. Từ đó sẽ thấy được các cảnh báo bảo mật trên Security Hub và GuardDuty sẽ chủ động ngăn chặn các cuộc tấn công thông qua các tài nguyên đã được chuẩn bị từ trước (Lambda function, EventBridge Rules, SNS Topic,\u0026hellip;)\nNội dung 3.1. Compromised EC2 Instance 3.2. Compromised IAM credentials 3.3. Create Findings 3.4 Credential Exfiltration\n"
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/2-prerequiste/2.3-createstack/",
	"title": "Tạo Stack",
	"tags": [],
	"description": "",
	"content": "Tạo Stack Trong bước này chúng ta sẽ tiến hành tạo Stack để theo dõi và ngăn chặn các cuộc tấn công thông qua Findings trên GuardDuty.\nĐăng nhập vào AWS Console. Truy cập vào Giao diện quản trị dịch vụ CloudFormation. Tiến hành tạo Stack mới bằng việc ấn nút Create stack. Ở trang Specify template, click vào Upload a template file. Tải file template tại đây.\nỞ trang Paraments, chúng ta sẽ nhập một số thông tin bắt buộc sau: Email Address: Địa chỉ email của bạn. Click Next. Ở trang Specify Stack Details, ấn Next. Ở trang Configure stack options, ấn Next. Ở trang Capabilities, tiến hành chấp nhận (Acknowledge) cho phép Template tạo các IAM role, cuối cùng chọn nút Create Stack. Kiểm tra lại các thông tin, ấn Submit. Quá trình trên sẽ diễn ra trong vòng 5-10 phút cho tới khi chúng ta thấy được trạng thái của Stack là CREATE_COMPLETE. Sau đó, chúng ta sẽ nhận được một thông báo qua Email với chủ đề tương tự AWS Notification - Subscription Confirmation.\nCác tài nguyên được chuẩn bị Dịch vụ EC2: 2 instances với tên gọi là Compromised Instance. 1 instance với tên gọi là Malicious Instance. Dịch vụ IAM: 1 IAM Role dành cho EC2 instance với quyền hạn truy cập đến SSM Parameter Store và DynamoDB. Dịch vụ SNS: 1 SNS Topic gửi thông báo qua E-mail. Dịch vụ EventBridge: 3 EventBridge Events Rules cho việc kích hoạt các thông báo và quá trình khắc phục. Dịch vụ Lambda: 2 Lambda Functions tiến hành khắc phục các lỗ hổng. Dịch vụ SSM: 1 SSM Parameter Store dùng để chứa mật khẩu cho môi trường TESTING. "
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/4-cleanup/",
	"title": "Dọn dẹp tài nguyên  ",
	"tags": [],
	"description": "",
	"content": "Chúng ta sẽ tiến hành các bước sau để xóa các tài nguyên chúng ta đã tạo trong bài thực hành này.\nXóa S3 Bucket Truy cập S3 Bucket Empty các S3 Bucket vừa tạo Delete các S3 Bucket. Xóa IAM Role Truy cập IAM Role Tìm kiếm GuardDuty-Example-EC2-Compromised Delete Vô hiệu hóa Amazon GuardDuty Truy cập Amazon GuardDuty Nhấn vào mục Setting Chọn Disable GuardDuty Ấn Save Vô hiệu hóa Security Hub Truy cập Security Hub Ở thanh bên trái, chọn Setting Ở Setting chọn General Cuộn xuống, chọn Disable AWS Security Hub CSPM Xóa Stack Truy cập CloudFormation Chọn Stack vừa tạo Delete Nếu xóa không được, vui lòng xem lại xóa S3 Bucket và xóa IAM Role\n"
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "http://localhost:1313/MyFirstWorkShop/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]