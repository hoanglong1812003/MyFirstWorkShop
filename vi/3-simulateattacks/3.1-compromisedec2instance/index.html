<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.147.8">
    <meta name="description" content="">
<meta name="author" content="hoanglong1812003@gmail.com">

    <link rel="icon" href="../../../images/favicon.png" type="image/png">

    <title>Compromised EC2 Instance :: AWS GuardDuty &amp; Security Hub</title>

    
    <link href="../../../css/nucleus.css?1750999081" rel="stylesheet">
    <link href="../../../css/fontawesome-all.min.css?1750999081" rel="stylesheet">
    <link href="../../../css/hybrid.css?1750999081" rel="stylesheet">
    <link href="../../../css/featherlight.min.css?1750999081" rel="stylesheet">
    <link href="../../../css/perfect-scrollbar.min.css?1750999081" rel="stylesheet">
    <link href="../../../css/auto-complete.css?1750999081" rel="stylesheet">
    <link href="../../../css/atom-one-dark-reasonable.css?1750999081" rel="stylesheet">
    <link href="../../../css/theme.css?1750999081" rel="stylesheet">
    <link href="../../../css/hugo-theme.css?1750999081" rel="stylesheet">
    
    <link href="../../../css/theme-workshop.css?1750999081" rel="stylesheet">
    
    

    <script src="../../../js/jquery-3.3.1.min.js?1750999081"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../../../vi/3-simulateattacks/3.1-compromisedec2instance/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="../../../">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../../js/lunr.min.js?1750999081"></script>
<script type="text/javascript" src="../../../js/auto-complete.js?1750999081"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/hoanglong1812003.github.io\/MyFirstWorkShop\/\/vi";
    
</script>
<script type="text/javascript" src="../../../js/search.js?1750999081"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/2-prerequiste/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.1-enableguardduty/" title="Kích hoạt GuardDuty" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/2-prerequiste/2.1-enableguardduty/">
           <b> 2.1 </b> Kích hoạt GuardDuty
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.2-enablesecurityhub/" title="Kích hoạt Security Hub" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/2-prerequiste/2.2-enablesecurityhub/">
           <b> 2.2 </b> Kích hoạt Security Hub
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/2-prerequiste/2.3-createstack/" title="Tạo Stack" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/2-prerequiste/2.3-createstack/">
           <b> 2.3 </b> Tạo Stack
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-simulateattacks/" title="Mô phỏng các cuộc tấn công" class="dd-item 
        parent
        
        
        ">
      <a href="../../../vi/3-simulateattacks/">
           <b> 3. </b> Mô phỏng các cuộc tấn công
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-simulateattacks/3.1-compromisedec2instance/" title="Compromised EC2 Instance" class="dd-item 
        
        active
        
        ">
      <a href="../../../vi/3-simulateattacks/3.1-compromisedec2instance/">
           <b> 3.1. </b> Compromised EC2 Instance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-simulateattacks/3.2-compromisediamcredentials/" title="Compromised IAM credentials" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-simulateattacks/3.2-compromisediamcredentials/">
           <b> 3.2. </b> Compromised IAM credentials
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-simulateattacks/3.3-createfindings/" title="Create Findings" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-simulateattacks/3.3-createfindings/">
           <b> 3.3. </b> Create Findings
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-simulateattacks/3.4-credential-exfiltration/" title="Credential Exfiltration" class="dd-item 
        
        
        
        ">
      <a href="../../../vi/3-simulateattacks/3.4-credential-exfiltration/">
           <b> 3.4. </b> Credential Exfiltration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-cleanup/" title="Dọn dẹp tài nguyên  " class="dd-item 
        
        
        
        ">
      <a href="../../../vi/4-cleanup/">
          <b>4. </b>Dọn dẹp tài nguyên  
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://hoanglong1812003.github.io/MyFirstWorkShop/3-simulateattacks/3.1-compromisedec2instance/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="https://hoanglong1812003.github.io/MyFirstWorkShop/vi/3-simulateattacks/3.1-compromisedec2instance/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>27-06-2025</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/long-ho%C3%A0ng-6545b8350/"  style="color:orange">Huỳnh Hoàng Long </a> <br>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../../vi/'>Phát hiện các mối đe dọa với Amazon GuardDuty</a> > <a href='../../../vi/3-simulateattacks/'>Mô phỏng các cuộc tấn công</a> > Compromised EC2 Instance
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#tình-huống-1">Tình huống 1</a></li>
        <li><a href="#kiến-trúc-tổng-quan">Kiến trúc tổng quan</a></li>
        <li><a href="#quá-trình-điều-tra">Quá trình điều tra</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Compromised EC2 Instance
            </h1>
          

        



	<h3 id="tình-huống-1">Tình huống 1</h3>
<p>Vào một buổi sáng thứ 2, bạn Long đến văn phòng sớm, chuẩn bị một tách cà phê, ngồi vào chỗ và mở laptop, bắt đầu các công việc hằng ngày như gửi E-mail, viết kế hoạch. Đột nhiên, bạn Long bắt đầu nhận một chuỗi những E-mails với nội dung liên quan đến sự phát hiện mới nhất đối với các mối nguy hại, điều mà bạn Long chưa từng thấy trước đây, tuy nhiên bạn Long bắt đầu tìm hiểu và điều tra ngay lập tức. Điều đáng mừng là đồng nghiệp của bạn, Việt đã thiết lập những phản ứng tự động dành cho những Findings ấy thế nên chúng đã được giải quyết tức.</p>
<p><em>Vậy những phản ứng tự động Việt đã thiết lập là những phản ứng nào?</em></p>
<p>Nội dung E-mail đầu tiên mà bạn Long được nhận được với việc EC2 instance của bạn có thể đã bị xâm nhập như sau:
<img src="../../../images/3.attack/3.1/1.png" alt="Compromised EC2 Instance">
Nội dung E-mail thứ hai ngay sau đó mà bạn nhận được với tình hình đã được giải quyết tức thì như sau:
<img src="../../../images/3.attack/3.1/2.png" alt="Compromised EC2 Instance"></p>
<h3 id="kiến-trúc-tổng-quan">Kiến trúc tổng quan</h3>
<p><img src="../../../images/3.attack/3.1/CompromisedEC2.png" alt="Compromised EC2 Instance"></p>
<ol>
<li>Một EC2 compromised instance, tiến hành gửi gói tin pings đến địa chỉ EIP của một EC2 instance nguy hại. Địa chỉ EIP đó đã được thêm ở Custom Threat List.</li>
<li>Security Hub phát hiện ra lỗ hổng bảo mật bất thường.</li>
<li>GuardDuty tiến hành theo dõi VPC Flow Logs (kể cả CloudTrail và DNS Logs) và phân tích tình hình dựa trên Machine Learning, Custom Threat List và một số cở sở khác.</li>
<li>GuardDuty sinh ra một Finding và hiển thị trên GuardDuty Console và gửi sự kiện này đến EventBridge Events.</li>
<li>Dựa trên sự kiện này, EventBridge Event Rule tiến hành phản ứng và kích hoạt đồng thời SNS Topic và Lambda Function tương ứng.</li>
<li>SNS Topic sẽ gửi E-mail cùng với chi tiết Finding cho bạn.</li>
<li>Lambda Function sẽ tiến hành cô lập EC2 compromised instance.</li>
</ol>
<blockquote>
<p>Khi Việt thiết lập thông báo E-mail cho sự kiện này, anh ấy chỉ thêm một vài thông tin nhất định về Finding ấy và cấu hình Lambda Function để tự động cô lập EC2 compromised instance. Mặc dù Finding đã được giải quyết, bạn vẫn quyết định tìm hiểu chi tiết hơn về các thiết lập và cấu hình hiện tại này của Việt.</p></blockquote>
<h3 id="quá-trình-điều-tra">Quá trình điều tra</h3>
<p>Mặc dù bạn có thể thấy các Findings này từ GuardDuty Console, đa số các khách hàng đều muốn tập hợp chúng, từ các AWS Regions và AWS Accounts, đến một hệ thống quản lý dữ liệu bảo mật tập trung (<strong>SIEM</strong>) để tiến hành phân tích và thực hiện quá trình Remediations. Cách tiếp cận thông dụng nhất là cấu hình GuardDuty dưới một mô hình Admin/Member và sử dụng quy trình kết hợp giữa EventBridge Event Rules và Lambda Function để tiến hành đẩy những Findings này tới <strong>SIEM</strong> hoặc một <strong>Centralized Logging Framework</strong>. Ngoài ra còn có một số giải pháp đến từ các đối tác của AWS, giúp khách hàng thực hiện các tác vụ hợp nhất và đẩy dữ liệu dễ dàng nhất.</p>
<ol>
<li>
<p>Truy cập  vào <a href="https://ap-southeast-1.console.aws.amazon.com/securityhub/home?region=ap-southeast-1#/">Security Hub</a> ở ap-southeast-1</p>
</li>
<li>
<p>Chúng ta sẽ thấy được các cảnh báo bảo mật ở GuardDuty
<img src="../../../images/3.attack/3.1/hub.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Tiến hành truy cập vào GuardDuty Console ở ap-southeast-1</p>
</li>
<li>
<p>Chúng ta sẽ thấy được một Finding với định dạng như sau <strong>UnauthorizedAccess:EC2/MaliciousIPCaller.Custom</strong>
<img src="../../../images/3.attack/3.1/4.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Nếu không có Finding nào, vui lòng ấn refresh và đợi.</p>
</li>
</ol>

<div class="notices note" ><p>Người dùng có thể truy xuất các Findings ở GuardDuty console trong vòng 90 ngày.</p>
</div>

<ol>
<li>Trong môi trường của bạn, kiểu Finding này chỉ ra rằng một EC2 instance đang thực hiện quá trình giao tiếp tới địa chỉ IP (đã được thêm vào Threat Lists).</li>
<li>Tiến hành chọn Lists ở thanh điều hướng (bên tay trái) để có thể xem Threat List mà Việt đã thêm trước đây <strong>Example-Threat-List</strong>.
<img src="../../../images/3.attack/3.1/5.png" alt="Compromised EC2 Instance"></li>
</ol>
<blockquote>
<p>GuardDuty sử dụng những hệ thống Threat Intelligence được cung cấp bởi đội ngũ AWS Security và bên thứ 3 như ProofPoint và CrowdStike. Bạn có thể mở rộng tầm quan sát của GuardDuty bằng cách tự cấu hình danh sách IP đáng tin cậy (Trusted IP Lists) và danh sách các mối nguy hại (Threat Lists). Nếu bạn đã thiết lập GuardDuty theo cấu trúc Admin/Member, từ tài khoản GuardDuty Admin, bạn có thể quản lý các danh sách trên và để các tài khoản Members kế thừa. Mặc nhiên, các tài khoản Members sẽ không quyền chỉnh sửa các danh sách này.</p></blockquote>

<div class="notices note" ><p>Trong tình huống giả lập này, EC2 compromised instance chỉ tiến hành truy cập đến EIP của một EC2 instance khác trong cùng VPC nhằm nội bộ hoá quá trình giả lập cùng luồng xử lý dữ liệu chỉ xảy ra trong môi trường của bạn. CloudFormation Template sẽ tự động tạo danh sách mối nguy hại (Threat Lists) và gán địa chỉ EIP này vào đó.</p>
</div>

<p><strong>Kiểm tra EventBridge Event Rule</strong>
Việt sử dụng EventBridge Event Rules để gửi thông báo đến bạn về các Findings cùng với nội dung các bước của quá trình Remediations. Chúng ta sẽ tiến hành khảo sát chi tiết hơn để hiểu rõ Việt đã thiết lập những gì và quá trình này diễn ra như thế nào?</p>
<ol>
<li>
<p>Truy cập vào <a href="https://ap-southeast-1.console.aws.amazon.com/events/home?region=ap-southeast-1#/">EventBridge</a> Console ở ap-southeast-1
<img src="../../../images/3.attack/3.1/6.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Ở thanh điều hướng bên tay trái, dưới <strong>Events</strong>, chọn <strong>Rules</strong>. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau <em>GuardDuty-Event</em>.</p>
</li>
<li>
<p>Tiến hành chọn quy tắc có tên là <strong>GuardDuty-Event-EC2-MaliciousIPCaller</strong>.
<img src="../../../images/3.attack/3.1/7.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Bạn sẽ dễ dàng nhận thấy có 2 mục tiêu tại vùng Targets.</p>
</li>
</ol>
<ul>
<li><strong>Lambda Function</strong></li>
<li><strong>SNS Topic</strong>: Tiến hành gửi thông báo E-mail cho bạn dựa trên dữ liệu được cung cấp bởi <strong>EventBridge Event Rule</strong>. Thay vì toàn bộ dữ liệu JSON được sử dụng, bằng việc sử dụng <strong>Input Transformer</strong>, Việt đã tuỳ chỉnh nội dung thông báo.
<img src="../../../images/3.attack/3.1/8.png" alt="Compromised EC2 Instance"></li>
</ul>
<p><strong>Kiểm tra quá trình Remediation dựa trên Lambda Function</strong></p>
<p>Lambda Function là chìa khoá nắm giữ logic nhằm thực hiện các bước của quá trình Remediations dành cho các Findings. Việt đã thiết lập Lambda Function nhằm loại bỏ và thay thế Security Group của EC2 compromised instance bằng một Security Group <strong>không chứa bất kỳ một quy tắc Ingress/Egress nào</strong>. Điều này sẽ giúp <strong>cô lập EC2 compromised instance ra khỏi hệ thống mạng hiện tại</strong>.</p>
<p><em>Để tiến hành kiểm tra quá trình Remediation:</em></p>
<ol>
<li>
<p>Từ quy tắc <em>GuardDuty-Event-EC2-MaliciousIPCaller</em>, tại vùng <strong>Targets</strong>, ở mục <strong>Type</strong> là Lambda Function, chúng ta tìm kiếm <strong>Resource Name</strong> tương ứng.</p>
</li>
<li>
<p>Tại Lambda Function console, tìm kiếm <strong>Resource Name</strong> theo bước trước.</p>
</li>
<li>
<p>Chúng ta có thể xem xét một số mục</p>
</li>
</ol>
<ul>
<li>Configuration
<ul>
<li>Tại thanh Designer, chúng ta sẽ dễ dàng thấy mối quan hệ với EventBridge Event Rule.</li>
<li>Ở phần Function code, những logic về coding sẽ được thực thi tại đây.</li>
</ul>
</li>
<li>Permissions</li>
<li>Monitoring
<img src="../../../images/3.attack/3.1/9.png" alt="Compromised EC2 Instance">
<img src="../../../images/3.attack/3.1/10.png" alt="Compromised EC2 Instance"></li>
</ul>
<p><strong>Xác nhận quá trình Remediation đã thành công</strong>
Để đảm bảo kết quả của quá trình Remediation, chúng ta cần phải xem xét EC2 instance đã bị cô lập hay chưa. Tại thời điểm này, bạn đã nhận được một E-mail cùng với một số thông tin quan trọng.</p>
<ol>
<li>
<p>Truy cập vào EC2 console ở ap-southeast-1 tại <a href="https://ap-southeast-1.console.aws.amazon.com/ec2/home?region=ap-southeast-1#Overview:">đây</a>
<img src="../../../images/3.attack/3.1/11.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Chọn <strong>Instances</strong>, chúng sẽ thấy được 3 EC2 instance với tiền tố bắt đầu với định dạng sau <em>GuardDuty-Example</em>.</p>
</li>
<li>
<p>Dựa trên <strong>instance ID</strong> có từ GuardDuty Finding hay thông báo E-mail, chúng ta chọn EC2 instance tương ứng: <em>GuardDuty-Example: Compromised Instance: Scenario 1</em>.
<img src="../../../images/3.attack/3.1/12.png" alt="Compromised EC2 Instance"></p>
</li>
<li>
<p>Sau khi quá trình Remediation hoàn thành, chúng ta sẽ kiểm tra <strong>Security Group</strong> của EC2 compromised instance này, sẽ có định dạng tên tương tự sau <strong>ForensicSecurityGroup</strong>.</p>
</li>
<li>
<p><strong>ForensicSecurityGroup</strong> sẽ không có bất kỳ một quy tắc Ingress/Egress nào chứa địa chỉ IP trong <strong>Example-Threat-List</strong>.
<img src="../../../images/3.attack/3.1/13.png" alt="Compromised EC2 Instance"></p>
</li>
</ol>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../../vi/3-simulateattacks/" title="Mô phỏng các cuộc tấn công"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../../vi/3-simulateattacks/3.2-compromisediamcredentials/" title="Compromised IAM credentials" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../../js/clipboard.min.js?1750999081"></script>
    <script src="../../../js/perfect-scrollbar.min.js?1750999081"></script>
    <script src="../../../js/perfect-scrollbar.jquery.min.js?1750999081"></script>
    <script src="../../../js/jquery.sticky.js?1750999081"></script>
    <script src="../../../js/featherlight.min.js?1750999081"></script>
    <script src="../../../js/highlight.pack.js?1750999081"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../../js/modernizr.custom-3.6.0.js?1750999081"></script>
    <script src="../../../js/learn.js?1750999081"></script>
    <script src="../../../js/hugo-learn.js?1750999081"></script>

    <link href="../../../mermaid/mermaid.css?1750999081" rel="stylesheet" />
    <script src="../../../mermaid/mermaid.js?1750999081"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
